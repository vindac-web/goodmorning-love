<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Morning Love - Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’•</text></svg>">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        :root { --primary: #d63384; --primary-hover: #b02a6a; }
        body { padding: 1rem; }
        .container { max-width: 1200px; margin: 0 auto; }
        .nav-tabs {
            display: flex !important;
            gap: 0 !important;
            margin-bottom: 2rem !important;
            border-bottom: 2px solid #ccc !important;
            overflow-x: auto !important;
            list-style: none !important;
            padding: 0 !important;
            background: transparent !important;
        }
        .nav-tabs .nav-tab {
            padding: 0.75rem 1.25rem !important;
            cursor: pointer !important;
            text-decoration: none !important;
            color: #555 !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            border: none !important;
            border-bottom: 3px solid transparent !important;
            margin-bottom: -2px !important;
            white-space: nowrap !important;
            display: inline-block !important;
            background: transparent !important;
            box-shadow: none !important;
        }
        .nav-tabs .nav-tab:hover {
            color: var(--primary) !important;
            text-decoration: none !important;
        }
        .nav-tabs .nav-tab.active {
            border-bottom-color: var(--primary) !important;
            color: var(--primary) !important;
            font-weight: 600 !important;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .status-grid { display: grid; gap: 1rem; margin-bottom: 2rem; }
        @media (min-width: 768px) { .status-grid { grid-template-columns: repeat(2, 1fr); } }
        .status-card { padding: 1.5rem; border-radius: 0.5rem; background: var(--card-background-color); border: 1px solid var(--muted-border-color); }
        .status-card h3 { margin-top: 0; margin-bottom: 1rem; font-size: 1rem; color: var(--muted-color); }
        .status-value { font-size: 1.5rem; font-weight: 600; }
        .question-item { display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem; padding: 1rem; border: 1px solid var(--muted-border-color); border-radius: 0.5rem; }
        .question-number { font-weight: 600; min-width: 2rem; }
        .question-text { flex: 1; }
        .question-actions { display: flex; gap: 0.5rem; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
        .history-entry { padding: 1rem; border: 1px solid var(--muted-border-color); border-radius: 0.5rem; margin-bottom: 1rem; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .history-type { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .history-type.question { background: #e7f3ff; color: #0969da; }
        .history-type.reply { background: #dafbe1; color: #1a7f37; }
        .history-type.girlfriend_message { background: #ffeff7; color: #bf3989; }
        .toast { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 1.5rem; border-radius: 0.5rem; background: var(--card-background-color); border: 1px solid var(--muted-border-color); box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; animation: slideIn 0.3s ease-out; }
        .toast.success { border-color: #1a7f37; background: #dafbe1; color: #1a7f37; }
        .toast.error { border-color: #cf222e; background: #ffebe9; color: #cf222e; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .template-preview { padding: 1rem; background: var(--code-background-color); border-radius: 0.5rem; margin-top: 0.5rem; white-space: pre-wrap; font-family: monospace; font-size: 0.875rem; }
        .loading { opacity: 0.6; pointer-events: none; }
        .hidden { display: none; }
        .dashboard-header { margin-bottom: 0; overflow: hidden; }
        .dashboard-header h1 { margin-bottom: 0.5rem; }
        .logout-btn { float: right; position: relative; z-index: 100; }
    </style>
</head>
<body>
    <div id="login-page" class="container">
        <article style="max-width: 400px; margin: 5rem auto;">
            <h2>Dashboard Login</h2>
            <p>Enter your password to access the dashboard</p>
            <form id="login-form">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required autofocus>
                <button type="submit">Login</button>
            </form>
        </article>
    </div>
    <div id="dashboard" class="container hidden">
        <div class="dashboard-header">
            <h1>Good Morning Love Dashboard ðŸ’•</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div><!-- end dashboard-header -->
        <style>.nav-tabs,.nav-tabs *{all:unset!important}.nav-tabs{display:flex!important;gap:0!important;margin-bottom:2rem!important;border-bottom:2px solid #ccc!important;padding:0!important}.nav-tabs .nav-tab{display:inline-block!important;padding:12px 20px!important;cursor:pointer!important;color:#555!important;font-size:16px!important;font-weight:500!important;font-family:system-ui,sans-serif!important;border-bottom:3px solid transparent!important;margin-bottom:-2px!important}.nav-tabs .nav-tab:hover{color:#d63384!important}.nav-tabs .nav-tab.active{color:#d63384!important;font-weight:600!important;border-bottom-color:#d63384!important}</style>
<div class="nav-tabs">
            <span class="nav-tab active" onclick="switchTab(event, 'status')" style="color:#555;text-decoration:none;padding:0.75rem 1.25rem;border-bottom:3px solid #d63384;margin-bottom:-2px;">Status</span>
            <span class="nav-tab" onclick="switchTab(event, 'questions')" style="color:#555;text-decoration:none;padding:0.75rem 1.25rem;border-bottom:3px solid transparent;margin-bottom:-2px;">Questions</span>
            <span class="nav-tab" onclick="switchTab(event, 'schedule')" style="color:#555;text-decoration:none;padding:0.75rem 1.25rem;border-bottom:3px solid transparent;margin-bottom:-2px;">Schedule</span>
            <span class="nav-tab" onclick="switchTab(event, 'templates')" style="color:#555;text-decoration:none;padding:0.75rem 1.25rem;border-bottom:3px solid transparent;margin-bottom:-2px;">Templates</span>
            <span class="nav-tab" onclick="switchTab(event, 'history')" style="color:#555;text-decoration:none;padding:0.75rem 1.25rem;border-bottom:3px solid transparent;margin-bottom:-2px;">History</span>
        </div>
        <div id="tab-status" class="tab-content active">
            <h2>App Status</h2>
            <div class="status-grid">
                <div class="status-card"><h3>Morning Questions Time</h3><div class="status-value" id="morning-time-display">--:--</div></div>
                <div class="status-card"><h3>Girlfriend Message Time</h3><div class="status-value" id="girlfriend-time-display">--:--</div></div>
                <div class="status-card"><h3>Timezone</h3><div class="status-value" id="timezone-display">---</div></div>
                <div class="status-card"><h3>Status</h3><div class="status-value">âœ… Running</div></div>
            </div>
            <h3>Phone Numbers</h3>
            <p><strong>My Number:</strong> <span id="my-number">+1 ***-***-****</span></p>
            <p><strong>Girlfriend Number:</strong> <span id="gf-number">+1 ***-***-****</span></p>
            <h3>Channel Preferences</h3>
            <p><strong>My Channels:</strong> <span id="my-channels">---</span></p>
            <p><strong>Girlfriend Channels:</strong> <span id="gf-channels">---</span></p>
            <h3>Quick Actions</h3>
            <button onclick="sendQuestions()" class="contrast">Send Questions Now</button>
            <button onclick="sendVoiceMessage()" class="secondary">Send Voice Message</button>
            <h3>Test Girlfriend Message</h3>
            <label for="test-media-url">Media URL (optional)</label>
            <input type="url" id="test-media-url" placeholder="https://example.com/image.gif">
            <button onclick="fetchRandomGif()" class="secondary">Random Love GIF</button>
            <button onclick="sendTestGirlfriend()" class="contrast">Send Test Girlfriend Message</button>
        </div>
        <div id="tab-questions" class="tab-content">
            <h2>Morning Questions</h2>
            <div id="questions-list"></div>
            <button onclick="addQuestion()" class="secondary">Add Question</button>
            <button onclick="saveQuestions()" class="contrast">Save Questions</button>
        </div>
        <div id="tab-schedule" class="tab-content">
            <h2>Schedule Settings</h2>
            <form id="schedule-form" onsubmit="saveSchedule(event)">
                <label for="morning-time">Morning Questions Time (24-hour)</label>
                <input type="time" id="morning-time" required>
                <label for="girlfriend-time">Girlfriend Message Time (24-hour)</label>
                <input type="time" id="girlfriend-time" required>
                <label for="timezone">Timezone</label>
                <select id="timezone" required>
                    <option value="America/New_York">Eastern Time (ET)</option>
                    <option value="America/Chicago">Central Time (CT)</option>
                    <option value="America/Denver">Mountain Time (MT)</option>
                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                    <option value="Pacific/Honolulu">Hawaii Time (HST)</option>
                </select>
                <button type="submit" class="contrast">Save Schedule</button>
            </form>
        </div>
        <div id="tab-templates" class="tab-content">
            <h2>Message Templates</h2>
            <p>Use <code>{loveNote}</code>, <code>{gratitude}</code>, and <code>{encouragement}</code> as placeholders.</p>
            <div id="templates-list"></div>
            <button onclick="addTemplate()" class="secondary">Add Template</button>
            <button onclick="saveTemplates()" class="contrast">Save Templates</button>
        </div>
        <div id="tab-history" class="tab-content">
            <h2>Message History</h2>
            <div id="history-list"></div>
        </div>
    </div>
    <script>
        var sessionToken = localStorage.getItem('dashboard_session');
        function switchTab(event, tabName) {
            event.preventDefault();
            document.querySelectorAll('.nav-tab').forEach(function(t) {
                t.classList.remove('active');
                t.style.color = '#555';
                t.style.borderBottom = '3px solid transparent';
            });
            document.querySelectorAll('.tab-content').forEach(function(t) { t.classList.remove('active'); });
            event.target.classList.add('active');
            event.target.style.color = '#d63384';
            event.target.style.borderBottom = '3px solid #d63384';
            document.getElementById('tab-' + tabName).classList.add('active');
            if (tabName === 'history') loadHistory();
            if (tabName === 'templates') loadTemplates();
        }
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            var password = document.getElementById('password').value;
            try {
                var res = await fetch('/api/dashboard/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password: password }) });
                var data = await res.json();
                if (data.success) { sessionToken = data.token || 'authenticated'; localStorage.setItem('dashboard_session', sessionToken); showDashboard(); }
                else { showToast('Invalid password', 'error'); }
            } catch (err) { showToast('Login failed: ' + err.message, 'error'); }
        });
        function showDashboard() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            loadStatus(); loadQuestions();
        }
        function logout() {
            fetch('/api/dashboard/logout', {method:'POST'}); localStorage.removeItem('dashboard_session'); sessionToken = null;
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }
        async function apiCall(url, options) {
            options = options || {};
            var headers = Object.assign({}, options.headers || {});
            if (sessionToken) headers['Authorization'] = 'Bearer ' + sessionToken;
            if (options.body && typeof options.body === 'object' && !(options.body instanceof FormData)) {
                headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(options.body);
            }
            var resp = await fetch(url, Object.assign({}, options, { headers: headers })); if (resp.status === 401) { logout(); return resp; } return resp;
        }
        async function loadStatus() {
            try {
                var res = await apiCall('/api/dashboard/status');
                var data = await res.json();
                document.getElementById('morning-time-display').textContent = data.schedule.morningTime || '--:--';
                document.getElementById('girlfriend-time-display').textContent = data.schedule.girlfriendSendTime || '--:--';
                document.getElementById('timezone-display').textContent = data.schedule.timezone || '---';
                if (data.phoneNumbers.my) document.getElementById('my-number').textContent = data.phoneNumbers.my;
                if (data.phoneNumbers.girlfriend) document.getElementById('gf-number').textContent = data.phoneNumbers.girlfriend;
                if (data.channels.my) document.getElementById('my-channels').textContent = data.channels.my;
                if (data.channels.girlfriend) document.getElementById('gf-channels').textContent = data.channels.girlfriend;
                if (data.schedule.morningTime) document.getElementById('morning-time').value = data.schedule.morningTime;
                if (data.schedule.girlfriendSendTime) document.getElementById('girlfriend-time').value = data.schedule.girlfriendSendTime;
                if (data.schedule.timezone) document.getElementById('timezone').value = data.schedule.timezone;
            } catch (err) { console.error('Failed to load status:', err); }
        }
        var questions = [];
        async function loadQuestions() {
            try { var res = await apiCall('/api/dashboard/questions'); var data = await res.json(); questions = data.questions || []; renderQuestions(); }
            catch (err) { console.error('Failed to load questions:', err); }
        }
        function renderQuestions() {
            var list = document.getElementById('questions-list');
            list.innerHTML = questions.map(function(q, i) { return '<div class="question-item"><span class="question-number">' + (i+1) + '.</span><input type="text" class="question-text" value="' + (q.text || q) + '" onchange="questions[' + i + '] = {number: ' + (i+1) + ', text: this.value}"><div class="question-actions"><button onclick="removeQuestion(' + i + ')" class="btn-sm secondary outline">Remove</button></div></div>'; }).join('');
        }
        function addQuestion() { questions.push({number: questions.length + 1, text: 'New question?'}); renderQuestions(); }
        function removeQuestion(index) { questions.splice(index, 1); renderQuestions(); }
        async function saveQuestions() {
            try { var res = await apiCall('/api/dashboard/questions', { method: 'PUT', body: { questions: questions } }); var data = await res.json(); if (data.success) showToast('Questions saved!', 'success'); else showToast('Failed', 'error'); }
            catch (err) { showToast('Error: ' + err.message, 'error'); }
        }
        async function saveSchedule(e) {
            e.preventDefault();
            try { var res = await apiCall('/api/dashboard/settings', { method: 'PUT', body: { morningTime: document.getElementById('morning-time').value, girlfriendSendTime: document.getElementById('girlfriend-time').value, timezone: document.getElementById('timezone').value } }); var data = await res.json(); if (data.success) showToast('Schedule saved!', 'success'); else showToast('Failed', 'error'); }
            catch (err) { showToast('Error: ' + err.message, 'error'); }
        }
        async function sendQuestions() { try { var res = await apiCall('/test/send-questions', { method: 'POST' }); var data = await res.json(); showToast(data.message || 'Sent!', data.success ? 'success' : 'error'); } catch (err) { showToast('Error: ' + err.message, 'error'); } }
        async function sendVoiceMessage() { try { var res = await apiCall('/test/send-voice', { method: 'POST' }); var data = await res.json(); showToast(data.message || 'Sent!', data.success ? 'success' : 'error'); } catch (err) { showToast('Error: ' + err.message, 'error'); } }
        async function sendTestGirlfriend() { try { var mu = document.getElementById('test-media-url').value; var body = mu ? { mediaUrl: mu } : {}; var res = await apiCall('/test/send-test-girlfriend', { method: 'PUT', body: body }); var data = await res.json(); showToast(data.message || 'Sent!', data.success ? 'success' : 'error'); } catch (err) { showToast('Error: ' + err.message, 'error'); } }
        async function fetchRandomGif() { try { var res = await fetch('https://api.giphy.com/v1/gifs/random?api_key=0UTRbFtkMxAplrohufYco5IY74U8hOes&tag=love&rating=pg'); var data = await res.json(); if (data.data && data.data.images) { document.getElementById('test-media-url').value = data.data.images.original.url; } } catch (err) { showToast('GIF fetch failed', 'error'); } }
        var templates = [];
        async function loadTemplates() { try { var res = await apiCall('/api/dashboard/templates'); var data = await res.json(); templates = data.templates || []; renderTemplates(); } catch (err) { console.error('Failed:', err); } }
        function renderTemplates() { var list = document.getElementById('templates-list'); list.innerHTML = templates.map(function(t, i) { return '<div class="question-item"><textarea onchange="templates[' + i + '] = this.value">' + t + '</textarea><button onclick="templates.splice(' + i + ', 1); renderTemplates();" class="btn-sm secondary outline">Remove</button></div>'; }).join(''); }
        function addTemplate() { templates.push('Good morning my love! {loveNote} {gratitude} {encouragement}'); renderTemplates(); }
        async function saveTemplates() { try { var res = await apiCall('/api/dashboard/templates', { method: 'PUT', body: { templates: templates } }); var data = await res.json(); if (data.success) showToast('Saved!', 'success'); else showToast('Failed', 'error'); } catch (err) { showToast('Error: ' + err.message, 'error'); } }
        async function loadHistory() { try { var res = await apiCall('/api/dashboard/history'); var data = await res.json(); var list = document.getElementById('history-list'); if (!data.history || data.history.length === 0) { list.innerHTML = '<p>No history yet.</p>'; return; } list.innerHTML = data.history.map(function(e) { return '<div class="history-entry"><div class="history-header"><span class="history-type ' + e.type + '">' + e.type + '</span><span class="history-status">' + new Date(e.timestamp).toLocaleString() + '</span></div><div class="history-message">' + (e.message || '') + '</div></div>'; }).join(''); } catch (err) { console.error('History failed:', err); } }
        function showToast(message, type) { type = type || 'success'; var toast = document.createElement('div'); toast.className = 'toast ' + type; toast.textContent = message; document.body.appendChild(toast); setTimeout(function() { toast.remove(); }, 3000); }
        if (sessionToken) { showDashboard(); }
    </script>
</body>
</html>
